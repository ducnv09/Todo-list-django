{% extends "base.html" %}
{% block title %}C√¥ng vi·ªác{% endblock %}
{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
  <div>
    <h1 class="h3 mb-1 text-dark">
      <i class="fas fa-clipboard-list me-2 text-primary"></i>C√¥ng vi·ªác c·ªßa t√¥i
    </h1>
    <p class="text-muted mb-0">Qu·∫£n l√Ω v√† theo d√µi c√¥ng vi·ªác h√†ng ng√†y</p>
  </div>
  <a class="btn btn-success btn-lg shadow-sm" href="{% url 'tasks:create' %}">
    <i class="fas fa-plus me-2"></i>Th√™m c√¥ng vi·ªác
  </a>
</div>

<div class="card shadow-sm border-0 mb-4">
  <div class="card-body">
    <form class="row g-3" method="get">
      <div class="col-md-6">
        <div class="input-group">
          <span class="input-group-text bg-light border-end-0">
            <i class="fas fa-search text-muted"></i>
          </span>
          <input name="q" class="form-control border-start-0" placeholder="T√¨m ki·∫øm c√¥ng vi·ªác..." value="{{ request.GET.q }}">
        </div>
      </div>
      <div class="col-md-4">
        <select class="form-select" name="status">
          <option value="">üîç T·∫•t c·∫£ tr·∫°ng th√°i</option>
          <option value="open" {% if request.GET.status == "open" %}selected{% endif %}>‚è≥ Ch∆∞a ho√†n th√†nh</option>
          <option value="done" {% if request.GET.status == "done" %}selected{% endif %}>‚úÖ ƒê√£ ho√†n th√†nh</option>
        </select>
      </div>
      <div class="col-md-2">
        <button class="btn btn-primary w-100">
          <i class="fas fa-filter me-1"></i>L·ªçc
        </button>
      </div>
    </form>
  </div>
</div>

<div class="row">
  {% for t in tasks %}
    <div class="col-12 mb-3">
      <div class="card border-0 shadow-sm h-100 {% if t.is_done %}bg-light{% endif %}">
        <div class="card-body">
          <div class="d-flex justify-content-between align-items-start">
            <div class="flex-grow-1">
              <div class="d-flex align-items-center mb-2">
                {% if t.is_done %}
                  <i class="fas fa-check-circle text-success fa-lg me-2"></i>
                {% else %}
                  <i class="far fa-circle text-muted fa-lg me-2"></i>
                {% endif %}
                <h5 class="card-title mb-0 {% if t.is_done %}text-decoration-line-through text-muted{% endif %}">
                  {{ t.title }}
                </h5>
                {% if t.is_done %}
                  <span class="badge bg-success ms-2">Ho√†n th√†nh</span>
                {% else %}
                  <span class="badge bg-warning text-dark ms-2">ƒêang th·ª±c hi·ªán</span>
                {% endif %}
              </div>

              {% if t.note %}
                <p class="card-text text-muted mb-2">
                  <i class="fas fa-sticky-note me-1"></i>
                  {{ t.note|truncatechars:150 }}
                </p>
              {% endif %}

              <div class="small text-muted">
                <i class="fas fa-calendar-plus me-1"></i>
                <strong>T·∫°o:</strong> {{ t.created_at|date:"d/m/Y H:i" }}
                {% if t.due_at %}
                  <span class="ms-3">
                    <i class="fas fa-calendar-check me-1"></i>
                    <strong>H·∫°n:</strong>
                    <span class="{% if not t.is_done and t.due_at < now %}text-danger fw-bold{% endif %}">
                      {{ t.due_at|date:"d/m/Y H:i" }}
                    </span>
                  </span>
                {% endif %}
              </div>
            </div>

            <div class="ms-3 d-flex flex-column gap-1">
              <a class="btn btn-sm btn-outline-primary" href="{% url 'tasks:update' t.pk %}" title="Ch·ªânh s·ª≠a">
                <i class="fas fa-edit"></i>
              </a>
              <a class="btn btn-sm btn-outline-danger" href="{% url 'tasks:delete' t.pk %}" title="X√≥a">
                <i class="fas fa-trash"></i>
              </a>
              <a class="btn btn-sm {% if t.is_done %}btn-outline-warning{% else %}btn-outline-success{% endif %}"
                 href="{% url 'tasks:toggle' t.pk %}"
                 title="{% if t.is_done %}ƒê√°nh d·∫•u ch∆∞a xong{% else %}ƒê√°nh d·∫•u ho√†n th√†nh{% endif %}">
                {% if t.is_done %}
                  <i class="fas fa-undo"></i>
                {% else %}
                  <i class="fas fa-check"></i>
                {% endif %}
              </a>
            </div>
          </div>
        </div>
      </div>
    </div>
  {% empty %}
    <div class="col-12">
      <div class="text-center py-5">
        <i class="fas fa-clipboard-list fa-3x text-muted mb-3"></i>
        <h4 class="text-muted">Ch∆∞a c√≥ c√¥ng vi·ªác n√†o</h4>
        <p class="text-muted">H√£y th√™m c√¥ng vi·ªác ƒë·∫ßu ti√™n c·ªßa b·∫°n!</p>
        <a href="{% url 'tasks:create' %}" class="btn btn-primary">
          <i class="fas fa-plus me-2"></i>Th√™m c√¥ng vi·ªác m·ªõi
        </a>
      </div>
    </div>
  {% endfor %}
</div>

{% if is_paginated %}
<nav class="mt-4 d-flex justify-content-center">
  <ul class="pagination pagination-lg shadow-sm">
    {% if page_obj.has_previous %}
      <li class="page-item">
        <a class="page-link" href="?page={{ page_obj.previous_page_number }}&q={{ request.GET.q }}&status={{ request.GET.status }}">
          <i class="fas fa-chevron-left"></i> Tr∆∞·ªõc
        </a>
      </li>
    {% endif %}

    <li class="page-item active">
      <span class="page-link">
        <i class="fas fa-file-alt me-1"></i>
        Trang {{ page_obj.number }} / {{ paginator.num_pages }}
      </span>
    </li>

    {% if page_obj.has_next %}
      <li class="page-item">
        <a class="page-link" href="?page={{ page_obj.next_page_number }}&q={{ request.GET.q }}&status={{ request.GET.status }}">
          Sau <i class="fas fa-chevron-right"></i>
        </a>
      </li>
    {% endif %}
  </ul>
</nav>
{% endif %}

<style>
  .card {
    transition: all 0.3s ease;
    border-radius: 15px;
  }

  .card:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 25px rgba(0,0,0,0.15) !important;
  }

  .btn {
    border-radius: 8px;
    transition: all 0.3s ease;
  }

  .btn:hover {
    transform: translateY(-1px);
  }

  .pagination .page-link {
    border-radius: 10px;
    margin: 0 2px;
    border: none;
    color: #6c757d;
  }

  .pagination .page-item.active .page-link {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    border: none;
  }

  .badge {
    border-radius: 20px;
    font-size: 0.75rem;
  }

  .input-group-text {
    border-radius: 10px 0 0 10px;
  }

  .form-control, .form-select {
    border-radius: 0 10px 10px 0;
  }

  .form-control:first-child, .form-select:only-child {
    border-radius: 10px;
  }
</style>
{% endblock %}
